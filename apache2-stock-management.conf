# Apache2 Virtual Host Configuration for Stock Management App
# Copy this file to /etc/apache2/sites-available/stock-management.conf

<VirtualHost *:80>
    # Replace with your domain name or server IP
    ServerName your-domain.com
    ServerAlias www.your-domain.com
    # For IP-based access: ServerName your-server-ip
    
    DocumentRoot /var/www/stock-management/stock-management-app
    
    # Proxy all requests to Node.js app running on port 3000
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Main proxy configuration
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    # WebSocket support for real-time features
    ProxyPass /ws/ ws://localhost:3000/ws/
    ProxyPassReverse /ws/ ws://localhost:3000/ws/
    
    # API routes
    ProxyPass /api/ http://localhost:3000/api/
    ProxyPassReverse /api/ http://localhost:3000/api/
    
    # Static files (Next.js handles these, but good to have)
    ProxyPass /_next/ http://localhost:3000/_next/
    ProxyPassReverse /_next/ http://localhost:3000/_next/
    
    # Headers for better proxy handling
    ProxyPassReverse / http://localhost:3000/
    ProxyPassReverseMatch ^/(.*) http://localhost:3000/$1
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/stock-management_error.log
    CustomLog ${APACHE_LOG_DIR}/stock-management_access.log combined
    
    # Optional: Redirect HTTP to HTTPS (uncomment after SSL setup)
    # RewriteEngine On
    # RewriteCond %{HTTPS} off
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

# SSL Virtual Host (uncomment after SSL certificate installation)
# <VirtualHost *:443>
#     ServerName your-domain.com
#     ServerAlias www.your-domain.com
#     
#     DocumentRoot /var/www/stock-management/stock-management-app
#     
#     # SSL Configuration (Certbot will add these automatically)
#     SSLEngine on
#     # SSLCertificateFile /path/to/certificate.crt
#     # SSLCertificateKeyFile /path/to/private.key
#     # SSLCertificateChainFile /path/to/chain.crt
#     
#     # Same proxy configuration as HTTP
#     ProxyPreserveHost On
#     ProxyRequests Off
#     ProxyPass / http://localhost:3000/
#     ProxyPassReverse / http://localhost:3000/
#     
#     # WebSocket support
#     ProxyPass /ws/ ws://localhost:3000/ws/
#     ProxyPassReverse /ws/ ws://localhost:3000/ws/
#     
#     # Security headers
#     Header always set X-Content-Type-Options nosniff
#     Header always set X-Frame-Options DENY
#     Header always set X-XSS-Protection "1; mode=block"
#     Header always set Referrer-Policy "strict-origin-when-cross-origin"
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
#     
#     # Logging
#     ErrorLog ${APACHE_LOG_DIR}/stock-management_ssl_error.log
#     CustomLog ${APACHE_LOG_DIR}/stock-management_ssl_access.log combined
# </VirtualHost>
